Лабораторная работа №1 Учётные записи пользователей в системе Linux
Цель: изучить содержимое файлов, где хранятся учётные записи и пароли пользователей и групп

1. Учётные записи располагаются в файле /etc/passwd
(Просмотр: vim /etc/passwd)
student:x:1001:1001::/home/student:/bin/bash
login:x:Номер пользователя:Номер группы по умолчанию:...:Адрес домашней папки:Командная оболочка

2. Пароли хранятся в теневом файле /etc/shadow
Доступ на чтение у файла есть только у админа и у группы root
tmp:!:20012:0:99999:7:::
Имя пользователя:Пароль ("!" - пароля не существует):Последнее изменение пароля:Минимальный возраст пароля: Максимальный возраст пароля: Период предупреждения: Период бездействия:Срок годности: Неиспользованный

3. Информация о группах: /etc/group
tmp:x:1002:

4. Информация о паролях для групп: /etc/gshadow
tmp:!::

5. Права доступа к объектам
Смена прав доступа к объектам выполняется администратором командой chmod
sudo chmod 775 <имя объекта>
sudo chmod g-x <имя объекта>

Смена владельцев и группы владельцев выполнятеся администратором командой chown
sudo chown <владелец:группа владельцев> <имя объекта>
sudo chgrp <группа владельцев> <имя объекта>

Режим группового доступа к объектам можно использовать при смене группы, заданной по умолчанию
newgrp <имя группы>

Специальные права доступа к объектам: SUID, GUID, sticky bit

Специальный бит SUID предназначен для запуска файла от имени его владельца. Эта процедура позволяет обычным пользователям получить права на доступ к объектам, которыми может распоряжаться владелец файла.
Пример - программа /bin/passwd, для функционирования которой нужны права записи в файл /etc/shadow
Такие права есть только у пользователя root, поэтому у программы /bin/passwd владелец root и установлен бит SUID.
В результате любой пользователь может сменить свой пароль, не обращаясь к администратору

Установка бита SUID осуществляется при помощи программы chmod:
sudo chmod u+s <имя файла>
sudo chmod 4775 <имя файла>

Сброс бита SUID осуществляется аналогично:
sudo chmod u-s <имя файла>
sudo chmod 0775 <имя файла>

Бит SUID нет смысла применять к папкам.

Специальный бит GUID предназначен для запуска файла от имени группы владельцев, либо для изменения правил наследования группы владельцев, если он установлен для папки

Установка бита GUID осуществляется при помощи программы chmod:
sudo chmod g+s <имя файла>
sudo chmod 2775 <имя файла>

Права доступа к файлу с установленным GUID:
-rwxrwsr-x 1 student root       0 окт 30 12:55  f1

Права доступа к каталогу с установленным GUID:
drwxrwsr-x 3 student root    4096 окт 30 13:18  F

При установке бита GUID на папку все объекты, созданные внутри папки, наследуют группу владельцев от родителя.
При этом дочерние папки наследуют бит GUID.

Пример: объекты в папке с установленным GUID:
-rw-rw-r-- 1 student root    0 окт 30 13:18 123
-rw-rw-r-- 1 student root    0 окт 30 13:18 234
drwxrwsr-x 2 student root 4096 окт 30 13:18 F123

GUID-бит применяется и для файлов, и для папок.

Sticky bit - устанавливается только на папки и определяет особые правила удаления объектов внутри папки
Для папок с устновленным Sticky bit запрещается операция удаления файлов даже для тех пользователей, кто имет права на запись. Владельцы объектов и пользователи, входящие в группу владельцев папки имеют возможность удалить свои объекты без ограничений

Устанавливается Sticky bit при помощи команды chmod:

sudo chmod o+t <имя папки>
sudo 1775 <имя папки>

Права доступа до установки спецбита:
student@alexander-VirtualBox:~$ stat SB008/
  Файл: SB008/
  Размер: 4096      	Блоков: 8          Блок В/В: 4096   каталог
Устройство: 803h/2051d	Инода: 974899      Ссылки: 2
Доступ: (0777/drwxrwxrwx)  Uid: ( 1001/ student)   Gid: ( 1001/ student)

Пример установки бита:
student@alexander-VirtualBox:~$ sudo chmod o+t SB008/
student@alexander-VirtualBox:~$ stat SB008/
  Файл: SB008/
  Размер: 4096      	Блоков: 8          Блок В/В: 4096   каталог
Устройство: 803h/2051d	Инода: 974899      Ссылки: 2
Доступ: (1777/drwxrwxrwt)  Uid: ( 1001/ student)   Gid: ( 1001/ student)

Права доступа к объектам внутри SB008:
tmp6@alexander-VirtualBox:/home/student/SB008$ ls -l
итого 8
drwxrwxrwx 2 student student 4096 ноя  6 12:37 F
-rw-rw-rw- 1 student student    0 ноя  6 12:36 f1
drwxrwxr-x 2 tmp6    tmp6    4096 ноя  6 12:39 F1
-rw-rw-rw- 1 student student    0 ноя  6 12:36 f2
-rw-rw-r-- 1 tmp6    tmp6       0 ноя  6 12:39 f3
-rw-rw-r-- 1 tmp6    tmp6       0 ноя  6 12:39 f4

Попытка удалить файл владельца student от пользователя tmp6:
tmp6@alexander-VirtualBox:/home/student/SB008$ rm f1
rm: невозможно удалить 'f1': Операция не позволена

При этом файл f1 пользователь tmp6 может редактировать и даже перезаписать полностью

От имени владельца папки с установленным Sticky bit можно удалять объекты без дополнительных ограничений:
student@alexander-VirtualBox:~/SB008/F$ ls -l
итого 0
-rw-rw-r-- 1 tmp6    tmp6    0 ноя  6 12:43 f1
-rw-rw-r-- 1 tmp6    tmp6    0 ноя  6 12:43 f2
-rw-rw-rw- 1 student student 0 ноя  6 12:43 f3
-rw-rw-rw- 1 student student 0 ноя  6 12:43 f4

student@alexander-VirtualBox:~/SB008/F$ rm f1
rm: удалить защищённый от записи пустой обычный файл 'f1'? y
student@alexander-VirtualBox:~/SB008/F$ ls
f2  f3  f4

student@alexander-VirtualBox:~/SB008$ rm f2
student@alexander-VirtualBox:~/SB008$ rm f4
rm: удалить защищённый от записи пустой обычный файл 'f4'? y
student@alexander-VirtualBox:~/SB008$ ls -l
итого 12
drwxrwxrwx 2 student student 4096 ноя  6 12:44 F
-rw-rw-rw- 1 student student   30 ноя  6 12:40 f1
drwxrwxr-x 2 tmp6    tmp6    4096 ноя  6 12:39 F1


